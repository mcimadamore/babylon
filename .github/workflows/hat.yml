name: Build and Test Babylon JDK

on:
  workflow_call:
    inputs:
      platform:
        required: true
        type: string
      bootjdk-platform:
        required: true
        type: string
      runs-on:
        required: true
        type: string
      xcode-toolset-version:
        required: false
        type: string
      dry-run:
        required: false
        type: boolean
        default: false
      debug-suffix:
        required: false
        type: string
      static-suffix:
        required: false
        type: string

jobs:
  run_hat_tests:
    runs-on: ${{ inputs.runs-on }}

    steps:
    # Install build dependencies for OpenJDK (adjust as needed)
    - name: Install build dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y ocl-icd-libopencl1 ocl-icd-opencl-dev clinfo
        # Verify OpenCL installation
        clinfo

    # Find the path to the built JDK (typically build/*/images/jdk)
    - name: Set JAVA_HOME and run hat build
      run: |
        # Find the jdk images directory
        export JAVA_HOME=${{ steps.bundles.outputs.jdk-path }}
        cd hat
        "$JAVA_HOME/bin/java" @hat/bld
